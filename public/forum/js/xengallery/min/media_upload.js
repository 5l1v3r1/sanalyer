/*
 * XenForo media_upload.min.js
 * Copyright 2010-2016 XenForo Ltd.
 * Released under the XenForo License Agreement: http://xenforo.com/license-agreement
 */
(function(d,n,m){XenForo.MediaGallery={SetAllImageTitles:function(a){a.click(function(){$titles=d("#SetAllImageTitleText").val();d("#SetAllImageTitleText").val("");$titles&&d(".SetImageTitle").each(function(a,c){var b=d(c),b=$titles.replace("%f",b.data("filename")),b=b.replace("%n",a+1);d(this).val(b)})})},SetAllImageDescriptions:function(a){a.click(function(){this.titles=d("#SetAllImageDescriptionText").val();d("#SetAllImageDescriptionText").val("");this.titles&&d(".SetImageDescription").val(this.titles)})},
SetAllVideoTitles:function(a){a.click(function(){this.titles=d("#SetAllVideoTitleText").val();d("#SetAllVideoTitleText").val("");this.titles&&d(".SetVideoTitle").val(this.titles)})},SetAllVideoDescriptions:function(a){a.click(function(){this.titles=d("#SetAllVideoDescriptionText").val();d("#SetAllVideoDescriptionText").val("");this.titles&&d(".SetVideoDescription").val(this.titles)})},InsertFilename:function(a){a.click(function(f){f.preventDefault();var f=a.data("filename"),c=a.data("target");d(c).val(f)})}};
XenForo.SetAllTitlesForm=function(a){a.closest("form").submit(function(a){a.preventDefault();return!1});a.overlay().close()};var j=XenForo.speed.normal,g=XenForo.speed.fast;XenForo.AttachmentDownloader=function(a){this.__construct(a)};XenForo.AttachmentDownloader.prototype={__construct:function(a){this.$input=a;this.url=a.data("href");this.uniqueKey=a.data("key");d(".DownloadTrigger").bind({click:d.context(this,"doDownload")})},doDownload:function(a){a.preventDefault();this.xhr=XenForo.ajax(this.url,
{image_url:this.$input.val()},d.context(this,"ajaxSuccess"),{error:"failure"});this.$input.val("")},ajaxSuccess:function(a){if(a.error){var f="";d.each(a.error,function(a,b){f+=b+"\n"});XenForo.alert(f);return!1}$container=d("#AttachmentUploader_image_upload");$container.trigger({type:"AttachmentUploaded",ajaxData:a})}};XenForo.AttachmentUploader=function(a){var f=d(a.data("trigger"));a.closest("form");var c=d(a.data("placeholder")),b={},e=null,k=null,h=a.data("maxfilesize");a.data("maxuploads");
var i=a.data("extensions"),l=a.data("uniquekey");this.uniqueKey=l;a.show();var g=XenForo.canonicalizeUrl(a.data("flashurl")||"js/swfupload/Flash/swfupload.swf");console.info("flash url: %s",g);typeof SWFUpload=="function"&&!n.navigator.userAgent.match(/Android|iOS|iPhone|iPad|Mobile Safari|Trident\/7.0/i)&&(e=new SWFUpload({upload_url:a.data("action"),file_post_name:a.data("postname"),file_types:"*."+(i.toLowerCase()+","+i.toUpperCase()).replace(/,/g,";*."),post_params:d.extend({_xfToken:XenForo._csrfToken,
_xfNoRedirect:1,_xfResponseType:"json"},b),button_placeholder_id:c.attr("id"),button_width:1,button_height:1,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:g,prevent_swf_caching:!1,swfupload_loaded_handler:function(){this.setButtonDimensions(f.outerWidth(),f.outerHeight());a.find(".HiddenInput").each(function(a,c){e.addPostParam(d(c).data("name"),d(c).data("value"))});d(m).bind("CSRFRefresh",function(a){a.ajaxData&&(e.addPostParam("_xfToken",a.ajaxData.csrfToken),
e.addPostParam("_xfSessionId",a.ajaxData.sessionId))})},file_dialog_complete_handler:function(){try{this.getStats().files_queued>0&&this.startUpload(this.getFile(0).ID)}catch(a){this.debug(a)}},file_queued_handler:function(c){var b;switch(c.name.substr(c.name.lastIndexOf(".")).toLowerCase()){case ".jpg":case ".jpeg":case ".jpe":case ".png":case ".gif":b=!0;break;default:b=!1}var e=d.Event("AttachmentQueueValidation");e.file=c;e.swfUpload=this;e.isImage=b;a.trigger(e);if(!e.isDefaultPrevented())h>
0&&c.size>h&&!b?(this.cancelUpload(c.id,!1),typeof this.settings.file_queue_error_handler=="function"&&this.settings.file_queue_error_handler.call(this,c,SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT,"The uploaded file is too large.")):(e=d.Event("AttachmentQueued"),e.file=c,e.swfUpload=this,e.isImage=b,a.trigger(e))},file_queue_error_handler:function(c,b,e){var f=d.Event("AttachmentQueueError");f.file=c;f.errorCode=b;f.message=e;f.swfUpload=this;a.trigger(f);f.isDefaultPrevented()||k(c,b,e)},upload_start_handler:function(a){console.log("Uploading %s",
a.name)},upload_progress_handler:function(c,b){a.trigger({type:"AttachmentUploadProgress",file:c,bytes:b,swfUpload:this})},upload_success_handler:function(c,b){try{var e=d.parseJSON(b)}catch(f){console.warn(f);return}e.error?a.trigger({type:"AttachmentUploadError",file:c,ajaxData:e,swfUpload:this}):a.trigger({type:"AttachmentUploaded",file:c,ajaxData:e,swfUpload:this})},upload_error_handler:function(c,b,e){b!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&(console.warn("Upload failed: %o",arguments),a.trigger({type:"AttachmentUploadError",
file:c,errorCode:b,message:e,ajaxData:{error:[a.data("err-unknown")]},swfUpload:this}))},upload_complete_handler:function(){try{this.getStats().files_queued>0?this.startUpload(this.getFile(0).ID):console.info("All files uploaded.")}catch(a){this.debug(a)}}}),k=function(c,b,e){b=a.data("err"+b)||e;c?XenForo.alert(b+"<br /><br />"+c.name):XenForo.alert(b)});d(m).bind("AutoInlineUploadComplete",function(c){if(l&&c.ajaxData&&l!==c.ajaxData.key)return!1;if(d(c.target).is("form.AttachmentUploadForm"))return f.overlay()&&
f.overlay().close(),a.trigger({type:"AttachmentUploaded",ajaxData:c.ajaxData}),!1});return{getSwfUploader:function(){return e},swfAlert:k}};XenForo.AttachmentEditor=function(a){this.setVisibility=function(c){var b=a.closest(".ctrlUnit"),e=a.find(".AttachmentInsertAllBlock"),d=a.find(".AttachedFile:not(#AttachedFileTemplate)"),f=d.parents(".AttachedFilesUnit").find(".ctrlUnit.submitUnit .button"),i=d.filter(".Processing"),g=d.filter(".AttachedImage");console.log("Attachments changed, total files: %d, images: %d",
d.length,g.length);b.length==0&&(b=a);c===!0?d.length?(g.length>1?e.show():e.hide(),b.show()):b.hide():d.length?(g.length>1?b.is(":hidden")?e.show():e.xfFadeDown(XenForo.speed.fast):b.is(":hidden")?e.hide():e.xfFadeUp(XenForo.speed.fast,!1,XenForo.speed.fast,"swing"),b.xfFadeDown(XenForo.speed.normal)):(e.slideUp(XenForo.speed.fast),b.xfFadeUp(XenForo.speed.normal,!1,!1,"swing"));i.length||f.prop("disabled",!1).removeClass("disabled")};this.setVisibility(!0);d("#AttachmentUploader_"+a.data("uploadtype")).bind({AttachmentQueued:function(c){console.info("Queued file %s (%d bytes).",
c.file.name,c.file.size);var b=d("#AttachedFileTemplate").clone().attr("id",c.file.id);b.find(".Filename").text(c.file.name);b.find(".ProgressCounter").text("0%");b.find(".ProgressGraphic span").css("width","0%");c.isImage&&b.addClass("AttachedImage");b.xfInsert("prependTo",".AttachmentList_"+a.data("uploadtype")+".New",null,j);b.find(".AttachmentCanceller").css("display","block").click(function(){c.swfUpload.cancelUpload(c.file.id);b.xfRemove(null,function(){a.trigger("AttachmentsChanged")},g,"swing")});
b.parents(".AttachedFilesUnit").find(".submitUnit .button").prop("disabled",!0).addClass("disabled");a.trigger("AttachmentsChanged")},AttachmentUploadProgress:function(a){console.log("Uploaded %d/%d bytes.",a.bytes,a.file.size);var b=Math.min(100,Math.ceil(a.bytes*100/a.file.size)),e=b+"%",a=d("#"+a.file.id),f=a.find(".ProgressCounter"),h=a.find(".ProgressGraphic");f.text(e);h.css("width",e);b>=100&&a.find(".AttachmentCanceller").prop("disabled",!0).addClass("disabled");h.width()>f.outerWidth()&&
f.appendTo(h)},AttachmentUploadError:function(a){var b="";d.each(a.ajaxData.error,function(a,c){b+=c+"\n"});XenForo.alert(b+"<br /><br />"+a.file.name);var e=d("#"+a.file.id),f=e.closest(".AttachmentEditor");e.xfRemove(null,function(){f.trigger("AttachmentsChanged")},g,"swing");console.warn("AttachmentUploadError: %o",a)},AttachmentUploaded:function(c){if(c.file){var b=d("#"+c.file.id),e=b.find(".AttachmentText"),f=b.find(".Thumbnail");new XenForo.ExtLoader(c.ajaxData,function(){e.fadeOut(XenForo.speed.fast,
function(){var a=d(c.ajaxData.templateHtml).find(".AttachmentText");a.xfInsert("insertBefore",e,"fadeIn",XenForo.speed.fast);d(c.ajaxData.templateHtml).find(".Thumbnail").xfInsert("replaceAll",f,null,j);e.xfRemove();a.find(".itemExtraInput.itemInputs").data("expanded")&&a.find("a.ToggleTrigger.ItemToggleTrigger").click();b.attr("id","attachment"+c.ajaxData.attachment_id)})})}else b=d("#attachment"+c.ajaxData.attachment_id),b.length||new XenForo.ExtLoader(c.ajaxData,function(){var b=d(c.ajaxData.templateHtml),
e=b.find(".AttachmentText");b.xfInsert("prependTo",a.find(".AttachmentList_"+a.data("uploadtype")+".New"),null,j);e.data("expanded")&&e.find("a.ToggleTrigger.ItemToggleTrigger").click()});b.removeClass("Processing");a.trigger("AttachmentsChanged")}});var f=d.context(this,"setVisibility");d("#QuickReply").bind("QuickReplyComplete",function(){a.find(".AttachmentList.New li:not(#AttachedFileTemplate)").xfRemove(null,f)});a.bind("AttachmentsChanged",f)};XenForo.AttachmentInserter=function(a){a.click(function(d){var c=
a.closest(".AttachedFile").find(".Thumbnail a"),b=c.data("attachmentid"),e;e=c.find("img").attr("src");c=c.attr("href");d.preventDefault();a.attr("name")=="thumb"?(d="[ATTACH]"+b+"[/ATTACH] ",e='<img src="'+e+'" class="attachThumb bbCodeImage" alt="attachThumb'+b+'" /> '):(d="[ATTACH=full]"+b+"[/ATTACH] ",e='<img src="'+c+'" class="attachFull bbCodeImage" alt="attachFull'+b+'" /> ');if(b=XenForo.getEditorInForm(a.closest("form"),":not(.NoAttachment)"))if(b.$editor){b.insertHtml(e);var g=b.$editor.data("xenForoElastic");
g&&(setTimeout(function(){g()},250),setTimeout(function(){g()},1E3))}else b.val(b.val()+d)})};XenForo.AttachmentDeleter=function(a){a.css("display","inline-block").click(function(a){var c=d(a.target),b=c.attr("href")||c.data("href"),e=c.closest(".AttachedFile"),a=c.closest(".AttachedFile").find(".Thumbnail a").data("attachmentid");if(b){e.xfFadeUp(XenForo.speed.normal,null,g,"swing");XenForo.ajax(b,"",function(a){if(XenForo.hasResponseError(a))return e.xfFadeDown(XenForo.speed.normal),!1;var b=e.closest(".AttachmentEditor");
e.xfRemove(null,function(){b.trigger("AttachmentsChanged")},g,"swing")});if(a&&(c=XenForo.getEditorInForm(c.closest("form"),":not(.NoAttachment)"))&&c.$editor)c.$editor.find("img[alt=attachFull"+a+"], img[alt=attachThumb"+a+"]").remove(),(a=c.$editor.data("xenForoElastic"))&&a();return!1}console.warn("Unable to locate href for attachment deletion from %o",c)})};XenForo.AttachmentInsertAll=function(a){a.click(function(){d(".AttachmentInserter[name="+a.attr("name")+"]").each(function(a,c){d(c).trigger("click")})})};
XenForo.AttachmentDeleteAll=function(a){a.click(function(){d(".AttachmentDeleter").each(function(a,c){d(c).trigger("click")})})};XenForo.register(".AttachmentDownloader","XenForo.AttachmentDownloader");XenForo.register(".AttachmentUploader","XenForo.AttachmentUploader");XenForo.register(".AttachmentEditor","XenForo.AttachmentEditor");XenForo.register(".AttachmentInserter","XenForo.AttachmentInserter");XenForo.register(".AttachmentDeleter","XenForo.AttachmentDeleter");XenForo.register(".AttachmentInsertAll",
"XenForo.AttachmentInsertAll");XenForo.register(".AttachmentDeleteAll","XenForo.AttachmentDeleteAll");XenForo.register(".SetAllTitlesOverlay","XenForo.SetAllTitlesForm");XenForo.register(".InsertFilename","XenForo.MediaGallery.InsertFilename");XenForo.register("a.SetAllImageTitles","XenForo.MediaGallery.SetAllImageTitles");XenForo.register("a.SetAllImageDescriptions","XenForo.MediaGallery.SetAllImageDescriptions");XenForo.register("a.SetAllVideoTitles","XenForo.MediaGallery.SetAllVideoTitles");XenForo.register("a.SetAllVideoDescriptions",
"XenForo.MediaGallery.SetAllVideoDescriptions")})(jQuery,this,document);
